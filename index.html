<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AIå¼€è¿ç©¿æ­å®˜</title>

  <!-- åˆ†äº«é¢„è§ˆ -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="AIå¼€è¿ç©¿æ­å®˜ï½œä»Šå¤©ç©¿å¯¹äº†ï¼Œå¥½è¿æ›´ä¸»åŠ¨">
  <meta property="og:description" content="ä¸€é”®ç”Ÿæˆä»Šæ—¥ç©¿æ­ + å¹¸è¿è‰² + å•†åŠ¡è°ˆåˆ¤å¥½è¿å¡ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ã€‚">
  <meta property="og:image" content="/cover.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="/cover.jpg">
  <link rel="apple-touch-icon" href="/cover.jpg">

  <style>
    :root{
      --card-max: 960px;
      --radius: 16px;
      --shadow-1: 0 6px 24px rgba(0,0,0,.10);
      --shadow-2: 0 6px 24px rgba(0,0,0,.08);
      --border: 1px solid #eee;
      --primary: #ff7043;
      --primary-hover: #ff5722;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","PingFang SC","Microsoft YaHei",sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #f8e79a 0%, transparent 60%),
                  radial-gradient(1200px 600px at 80% 100%, #ecb177 0%, transparent 60%),
                  linear-gradient(135deg,#f6d680,#eba567);
      color:#222;
    }
    .ghost{ background:#fafafa; border:1px solid #eee; color:#333; cursor:pointer; padding:6px 10px; border-radius:10px; }
    .ghost:hover{ background:#f3f3f3; }

    .card{ max-width:var(--card-max); margin:40px auto 18px; padding:20px; background:#fff; border-radius:var(--radius); box-shadow:var(--shadow-1); }
    .card h2{margin:0 0 6px}
    .card p{margin:0 0 10px; color:#575757}
    .controls{display:flex; flex-wrap:wrap; gap:10px 14px; align-items:center}
    .controls label{white-space:nowrap}
    .controls select, .card button{ padding:10px 12px; border-radius:10px; border:1px solid #ddd; background:#fff; outline:none; }
    .card .btns{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap}
    .card .btns button{ background:var(--primary); color:#fff; border:none; cursor:pointer; transition:background .2s ease, transform .05s ease; }
    .card .btns button:hover{ background:var(--primary-hover) }
    .card .btns button:active{ transform: translateY(1px) }

    #result-section{ display:none; max-width:var(--card-max); margin:0 auto 36px; }
    #result-section > .panel{ background:#fff; border-radius:var(--radius); box-shadow:var(--shadow-2); padding:18px; }
    #result-meta{ font-size:14px; color:#666; margin-bottom:8px; }
    #fortune-card{ display:none; border:1px dashed #cbd5e1; border-radius:12px; padding:12px; margin:10px 0 12px; background:#f8fafc }
    #fortune-card b{ color:#0f766e }
    #result-outfits{ display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:12px; }
    .outfit-card{ border:var(--border); border-radius:14px; padding:12px; }
    .outfit-card .name{ font-weight:700; margin-bottom:4px; }
    .outfit-card .meta{ font-size:12px; color:#6b7280 }
    .outfit-card .bar{ height:10px; border-radius:8px; background:#eee; margin:10px 0 6px; overflow:hidden; }
    .outfit-card .bar > i{ display:block; height:100%; width:70% }
    .outfit-card .sku{ font-size:12px; color:#8a8a8a }

    #avatar-preview{ display:none; max-width:var(--card-max); margin:12px auto 24px; }
    #avatar-preview > div{ background:#fff; border-radius:var(--radius); padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.06); }
    #avatar-img{ max-width:100%; border-radius:12px; display:block }

    #sku-modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); align-items:center; justify-content:center; z-index:9999; }
    #sku-modal .panel{ width:min(900px,94vw); background:#fff; border-radius:16px; padding:16px; max-height:86vh; overflow:auto; }
    #sku-modal .head{ display:flex; justify-content:space-between; align-items:center; gap:8px }
    #sku-list{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:10px; margin-top:12px }
    .sku-item{ display:flex; gap:10px; align-items:flex-start; border:var(--border); border-radius:12px; padding:10px; }
    #sku-modal button{ padding:8px 12px; border-radius:10px; border:1px solid #eee; background:#fafafa; cursor:pointer }
    #actions{ margin-top:12px; display:flex; gap:10px; flex-wrap:wrap }
    #actions button{ padding:8px 12px; border-radius:10px; border:1px solid #eee; background:#fafafa; cursor:pointer }

    @media (max-width:640px){ .card{margin:16px 12px} #result-section{margin:0 12px 24px} }
  </style>
</head>
<body>

  <div class="card">
    <div style="display:flex; justify-content:flex-end; margin-bottom:6px;">
      <button id="btn-auth" class="ghost">æ³¨å†Œ / ç™»å½•</button>
    </div>
    <h2>AIå¼€è¿ç©¿æ­å®˜ âœ¨</h2>
    <p>ä»Šå¤©ç©¿å¯¹äº†ï¼Œå¥½è¿æ›´ä¸»åŠ¨ã€‚ï¼ˆå¹¸è¿ç©¿ä¸Šèº«ï¼Œäº‹äº‹çš†é¡ºå¿ƒï¼‰</p>

    <div class="controls">
      <label>åœºæ™¯ï¼š
        <select data-field="scene">
          <option>åŒå­¦èšä¼š</option><option>çº¦ä¼š</option><option>é€šå‹¤</option>
          <option>è¿åŠ¨</option><option>æ—…è¡Œ</option><option>å•†åŠ¡</option>
        </select>
      </label>
      <label>å¤©æ°”/ä½“æ„Ÿï¼š
        <select data-field="weather">
          <option>é€‚ä¸­</option><option>ç‚çƒ­</option><option>å‡‰çˆ½</option>
          <option>å¯’å†·</option><option>é›¨å¤©</option>
        </select>
      </label>
      <label>å¹´é¾„æ®µï¼š
        <select data-field="age"><option>18-25</option><option>26-35</option><option>36-45</option></select>
      </label>
      <label>æ€§åˆ«ï¼š
        <select data-field="gender"><option>å¥³</option><option>ç”·</option><option>ä¸­æ€§</option></select>
      </label>
      <label>é£æ ¼åå¥½ï¼š
        <select data-field="style"><option>é€šç”¨</option><option>ç”œé…·</option><option>ä¼˜é›…</option><option>æœºèƒ½</option><option>å•†åŠ¡</option></select>
      </label>
    </div>

    <div class="btns">
      <button id="btn-go" onclick="generateOutfit()">âœ¨ä¸€é”®å¼€è¿</button>
      <button id="btn-upload">ä¸Šä¼ äººåƒï¼ˆè™šæ‹Ÿè¯•ç©¿Â·å³å°†ä¸Šçº¿ï¼‰</button>
      <button id="btn-sku">é€‰æ‹©æœè£…ï¼ˆå“ç‰ŒSKUÂ·å³å°†ä¸Šçº¿ï¼‰</button>
    </div>
  </div>

  <section id="result-section">
    <div class="panel">
      <h3 style="margin:0 0 8px;">ä»Šæ—¥å¼€è¿ç©¿æ­ âœ¨</h3>
      <div id="result-meta"></div>
      <div id="fortune-card"></div>
      <div id="result-outfits"></div>
      <div id="result-reason" style="margin-top:10px; font-size:14px;"></div>
      <div id="actions">
        <button id="btn-copy">å¤åˆ¶ç»“æœ(JSON)</button>
        <button id="btn-clear">æ¸…ç©ºç»“æœ</button>
      </div>
    </div>
  </section>

  <section id="avatar-preview">
    <div>
      <strong>äººåƒé¢„è§ˆ</strong>
      <div style="margin-top:8px;"><img id="avatar-img" alt="avatar"></div>
    </div>
  </section>

  <div id="sku-modal">
    <div class="panel">
      <div class="head">
        <h3 style="margin:0;">å¯é€‰æœè£…åº“ï¼ˆå‹¾é€‰å‚ä¸æ¨èï¼‰</h3>
        <button id="sku-close">å…³é—­</button>
      </div>
      <div style="font-size:12px;color:#666;margin:6px 0 12px;">ä»¥ä¸‹ä¸ºå ä½æ•°æ®ï¼Œåç»­å¯æ›¿æ¢ä¸ºçœŸå®å“ç‰ŒSKUä¸å›¾ç‰‡é“¾æ¥ã€‚</div>
      <div id="sku-list"></div>
      <div style="margin-top:12px; text-align:right;">
        <button id="sku-save">ä¿å­˜å¹¶å…³é—­</button>
      </div>
    </div>
  </div>

  <div id="auth-modal" style="display:none; position:fixed; inset:0;
       background:rgba(0,0,0,.35); align-items:center; justify-content:center;
       z-index:999999;">
    <div style="width:min(420px,94vw); background:#fff; border-radius:16px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.12);">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0;">æ³¨å†Œ / ç™»å½•</h3>
        <button id="auth-close" class="ghost">å…³é—­</button>
      </div>
      <div style="margin-top:12px; display:grid; gap:8px;">
        <input id="auth-phone" type="tel" inputmode="numeric" placeholder="æ‰‹æœºå·ï¼ˆä¸­å›½å¤§é™† 11 ä½ï¼‰" style="padding:10px; border:1px solid #ddd; border-radius:10px;">
        <input id="auth-pass" type="password" placeholder="å¯†ç ï¼ˆæ¼”ç¤ºç”¨ï¼‰" style="padding:10px; border:1px solid #ddd; border-radius:10px;">
        <button id="auth-submit" style="padding:10px 12px; border:none; border-radius:10px; background:#ff7043; color:#fff; cursor:pointer;">æäº¤</button>
        <small style="color:#666;">æ¼”ç¤ºç‰ˆä»…æœ¬åœ°ä¿å­˜ï¼Œä¸è¿æœåŠ¡å™¨ã€‚</small>
      </div>
    </div>
  </div>

  <script>
    if (!window.structuredClone) { window.structuredClone = function(obj){ return JSON.parse(JSON.stringify(obj)); }; }

    var el = {
      scene:  document.querySelector('select[data-field="scene"]'),
      weather:document.querySelector('select[data-field="weather"]'),
      age:    document.querySelector('select[data-field="age"]'),
      gender: document.querySelector('select[data-field="gender"]'),
      style:  document.querySelector('select[data-field="style"]'),

      go:        document.getElementById('btn-go'),
      upload:    document.getElementById('btn-upload'),
      chooseSKU: document.getElementById('btn-sku'),
      authBtn:   document.getElementById('btn-auth'),

      resultSection: document.getElementById('result-section'),
      resultMeta:    document.getElementById('result-meta'),
      resultList:    document.getElementById('result-outfits'),
      resultReason:  document.getElementById('result-reason'),
      fortune:       document.getElementById('fortune-card'),
      btnCopy: document.getElementById('btn-copy'),
      btnClear:document.getElementById('btn-clear'),

      avatarSection: document.getElementById('avatar-preview'),
      avatarImg:     document.getElementById('avatar-img'),

      skuModal: document.getElementById('sku-modal'),
      skuList:  document.getElementById('sku-list'),
      skuClose: document.getElementById('sku-close'),
      skuSave:  document.getElementById('sku-save'),

      authModal: document.getElementById('auth-modal'),
      authClose: document.getElementById('auth-close'),
      authSubmit:document.getElementById('auth-submit'),
      authPhone: document.getElementById('auth-phone'),
      authPass:  document.getElementById('auth-pass')
    };

    var LUCKY_PALETTES = {
      sunny:['#F7B500','#FF6A00','#FFD166'],
      cool:['#5C7CFA','#74C0FC','#B2F2BB'],
      rain:['#4DABF7','#748FFC','#4DCCC4'],
      neutral:['#8E9AAF','#F4ACB7','#9BF6FF']
    };
    var RULES = {
      scene2style:{
        'åŒå­¦èšä¼š':['ä¼‘é—²','ç®€çº¦'],
        'çº¦ä¼š':['ç”œé…·','ä¼˜é›…'],
        'é€šå‹¤':['é€šå‹¤','æç®€'],
        'è¿åŠ¨':['è¿åŠ¨'],
        'æ—…è¡Œ':['æˆ·å¤–','æœºèƒ½'],
        'å•†åŠ¡':['é€šå‹¤','æç®€','ä¼˜é›…']
      },
      weather2tags:{
        'é€‚ä¸­':['Tæ¤','ä¼‘é—²è£¤','ä¹ç¦é‹'],
        'ç‚çƒ­':['çŸ­è¢–','çŸ­è£™|çŸ­è£¤','å‡‰é‹'],
        'å‡‰çˆ½':['è¡¬è¡«','ç‰›ä»”','è¿åŠ¨é‹'],
        'å¯’å†·':['å¤–å¥—','æ¯›è¡£','é•¿è£¤','é´'],
        'é›¨å¤©':['é˜²æ°´å¤–å¥—','æœºèƒ½è£¤','é˜²æ°´é‹']
      },
      style2prefer:{
        'é€šç”¨':['ç®€çº¦','ä¼‘é—²','é€šå‹¤'],
        'ç”œé…·':['ç”œé…·','è¡—å¤´'],
        'ä¼˜é›…':['ä¼˜é›…','é€šå‹¤'],
        'æœºèƒ½':['æœºèƒ½','æˆ·å¤–'],
        'å•†åŠ¡':['é€šå‹¤','æç®€','ä¼˜é›…']
      }
    };

    var SKU_DB = [
      {id:'t001',  name:'ç´ è‰²åœ†é¢†Tæ¤',   cat:'Tæ¤',   styles:['ä¼‘é—²','ç®€çº¦','é€šå‹¤'], scenes:['åŒå­¦èšä¼š','é€šå‹¤','æ—…è¡Œ'], weathers:['é€‚ä¸­','ç‚çƒ­'], color:'#ffffff', checked:true},
      {id:'s001',  name:'é«˜è…°ç‰›ä»”è£¤',     cat:'ç‰›ä»”', styles:['ä¼‘é—²','è¡—å¤´'],       scenes:['åŒå­¦èšä¼š','æ—…è¡Œ'],       weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#2b303b', checked:true},
      {id:'sr001', name:'çŸ­è£¤',           cat:'çŸ­è£¤', styles:['ä¼‘é—²','è¡—å¤´'],       scenes:['æ—…è¡Œ','åŒå­¦èšä¼š'],       weathers:['ç‚çƒ­'],       color:'#64748b', checked:true},

      {id:'ts001', name:'çœŸä¸è¡¬è¡«',       cat:'è¡¬è¡«', styles:['ä¼˜é›…','é€šå‹¤','å•†åŠ¡'], scenes:['çº¦ä¼š','é€šå‹¤','å•†åŠ¡'],     weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#e2e8f0', checked:true},
      {id:'d001',  name:'ç›´ç­’é€šå‹¤è¥¿è£¤',   cat:'é•¿è£¤', styles:['é€šå‹¤','æç®€'],       scenes:['é€šå‹¤','å•†åŠ¡'],           weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#1f2937', checked:true},
      {id:'sh001', name:'ä¹ç¦é‹',         cat:'ä¹ç¦é‹', styles:['é€šå‹¤','ä¼˜é›…','ç®€çº¦'], scenes:['é€šå‹¤','å•†åŠ¡','åŒå­¦èšä¼š'], weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#000000', checked:true},

      {id:'sk001', name:'Aå­—åŠèº«è£™',     cat:'çŸ­è£™',   styles:['ä¼˜é›…','ç”œé…·'], scenes:['çº¦ä¼š','åŒå­¦èšä¼š'],   weathers:['ç‚çƒ­','é€‚ä¸­'], color:'#f472b6', checked:true, genders:['å¥³']},
      {id:'ps001', name:'èŒä¸šé“…ç¬”è£™',     cat:'åŠèº«è£™', styles:['ä¼˜é›…','é€šå‹¤','å•†åŠ¡'], scenes:['å•†åŠ¡','é€šå‹¤','çº¦ä¼š'], weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#9b87f5', checked:true, genders:['å¥³']},
      {id:'dr001', name:'ç›´ç­’è¿è¡£è£™',     cat:'è¿è¡£è£™', styles:['ä¼˜é›…','é€šå‹¤'], scenes:['å•†åŠ¡','çº¦ä¼š','é€šå‹¤'],   weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#f8d7da', checked:true, genders:['å¥³']},
      {id:'hs001', name:'5cmçŒ«è·Ÿé«˜è·Ÿé‹',  cat:'é«˜è·Ÿé‹', styles:['ä¼˜é›…','é€šå‹¤','å•†åŠ¡'], scenes:['å•†åŠ¡','çº¦ä¼š','é€šå‹¤'], weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#3b82f6', checked:true, genders:['å¥³']},

      {id:'bs004', name:'å¾·æ¯”é‹',         cat:'æ­£è£…é‹', styles:['é€šå‹¤','ä¼˜é›…'], scenes:['å•†åŠ¡','é€šå‹¤'], weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#0b0b0b', checked:true, genders:['ç”·','ä¸­æ€§']},

      {id:'sn001', name:'è·‘æ­¥è¿åŠ¨é‹',     cat:'è¿åŠ¨é‹', styles:['è¿åŠ¨','è¡—å¤´'], scenes:['è¿åŠ¨','æ—…è¡Œ'], weathers:['é€‚ä¸­','å‡‰çˆ½'], color:'#94a3b8', checked:true},

      {id:'o001',  name:'é˜²æ³¼æ°´æœºèƒ½å¤–å¥—', cat:'å¤–å¥—',   styles:['æœºèƒ½','æˆ·å¤–'], scenes:['æ—…è¡Œ','è¿åŠ¨'], weathers:['å‡‰çˆ½','é›¨å¤©','å¯’å†·'], color:'#0ea5e9', checked:true},
      {id:'co001', name:'ç¾Šæ¯›å‘¢å¤§è¡£',     cat:'å¤§è¡£',   styles:['é€šå‹¤','ä¼˜é›…','æç®€'], scenes:['å•†åŠ¡','é€šå‹¤'], weathers:['å¯’å†·','å‡‰çˆ½'], color:'#374151', checked:true},

      {id:'wd001', name:'é˜²æ°´çŸ­é´',       cat:'é˜²æ°´é‹', styles:['æœºèƒ½','é€šå‹¤'], scenes:['æ—…è¡Œ','é€šå‹¤'], weathers:['é›¨å¤©','å¯’å†·'], color:'#111827', checked:true}
    ];
    for (var i=0;i<SKU_DB.length;i++){ if(!SKU_DB[i].genders){ SKU_DB[i].genders=['ç”·','å¥³','ä¸­æ€§']; } }

    function $el(html){ var t=document.createElement('template'); t.innerHTML=html.trim(); return t.content.firstElementChild; }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function getPaletteByWeather(w){
      if (w.indexOf('é›¨')>-1) return LUCKY_PALETTES.rain;
      if (w.indexOf('å‡‰')>-1 || w.indexOf('å¯’')>-1) return LUCKY_PALETTES.cool;
      if (w.indexOf('çƒ­')>-1) return LUCKY_PALETTES.sunny;
      return LUCKY_PALETTES.neutral;
    }
    var persist = {
      save:function(k,v){ localStorage.setItem(k, JSON.stringify(v)); },
      read:function(k,d){ try{ var v=localStorage.getItem(k); return v?JSON.parse(v): (d===undefined?null:d);}catch(e){ return (d===undefined?null:d); } }
    };

    var DAILY_PALETTES = {
      'å¥³': {
        'ä¼˜é›…': ['#8B5CF6','#FDFBFF','#F472B6','#AEC8FF','#845EC2'],
        'å•†åŠ¡': ['#6B7280','#FDFDFC','#8B5CF6','#1F2937','#D1D5DB'],
        'ç”œé…·': ['#F472B6','#111827','#AE85FF','#FDFBFF','#EC4899'],
        'é€šç”¨': ['#9B87F5','#FDFDFD','#60A5FA','#FDA4AF','#A7F3D0']
      },
      'ç”·': {
        'å•†åŠ¡': ['#1F2937','#E5E7EB','#0EA5E9','#111827','#9CA3AF'],
        'é€šç”¨': ['#2563EB','#F3F4F6','#111827','#22D3EE','#9CA3AF']
      },
      'ä¸­æ€§': { 'é€šç”¨': ['#A8B5C0','#EEEDEB','#9FA3B0','#E6DCCE','#C7D2FE'] }
    };
    function hashStr(s){ var h=0,i; for(i=0;i<s.length;i++){ h=(h*131 + s.charCodeAt(i))>>>0; } return h; }
    function pickDailyColor(gender, stylePref){
      var day = new Date().toISOString().slice(0,10);
      var bank = (DAILY_PALETTES[gender] && DAILY_PALETTES[gender][stylePref]) ||
                 (DAILY_PALETTES[gender] && DAILY_PALETTES[gender]['é€šç”¨']) ||
                 DAILY_PALETTES['ä¸­æ€§']['é€šç”¨'];
      var idx = hashStr(day + '|' + gender + '|' + stylePref) % bank.length;
      return bank[idx];
    }

    /* ===== åŠ¨æ€å¥½è¿æç¤ºå¡ï¼ˆæç®€å¼ºåŠ›ç‰ˆï¼‰ ===== */
    function r(arr){return arr[Math.floor(Math.random()*arr.length)];}
    var SHORT = {
      title:{
        'å•†åŠ¡': ['è°ˆåˆ¤é¡ºé£','ç­¾çº¦å¿ƒæ€','èµ¢å•æ¨¡å¼','é«˜æ•ˆè¡¨è¾¾','å†³ç­–çª—å£'],
        'é€šå‹¤': ['å·¥ä½œé¡ºæ‰‹','ç¨³æ­¥æ¨è¿›','è¾“å‡ºé«˜èƒ½','èŠ‚å¥åœ¨çº¿'],
        'åŒå­¦èšä¼š': ['ç¤¾äº¤ç£åœº','äººè§äººçˆ±','ç„¦ç‚¹åœ¨ä½ '],
        'çº¦ä¼š': ['æ°›å›´æ‹¿æ','å¿ƒåŠ¨å‡ ç‡â†‘','æ¸©æŸ”åŠ æˆ'],
        'è¿åŠ¨': ['çŠ¶æ€åœ¨çº¿','è½»æ¾è¾¾æ ‡','ä¸“æ³¨å‘åŠ›'],
        'æ—…è¡Œ': ['ä¸€è·¯é¡ºé£','å‡ºç‰‡ä½“è´¨','è½»æ¾ä¸ç´¯']
      },
      opener:{
        'å•†åŠ¡': ['å…ˆåˆ©ååï¼Œä¿¡æ¯ç»“è®ºâ†’è¦ç‚¹â†’æ•°æ®','å…ˆå…±è¯†å†æ–¹æ¡ˆï¼Œå…ˆæ”¶ç›Šå†ç»†èŠ‚','åšå‡æ³•ï¼šä¸è¿‡ä¸‰è‰²ã€ç‰ˆå‹åˆ©è½'],
        'é€šå‹¤': ['ç®€æ´å³æ•ˆç‡ï¼Œç•™ç™½èƒœè£…é¥°','ä¼˜å…ˆåŒè‰²ç³»ï¼Œå¿«é€Ÿé€šå‹¤æ›´ä½“é¢'],
        'åŒå­¦èšä¼š': ['æ¾å¼›å‹å¥½ï¼Œä½é¥±å’Œæ›´è€çœ‹','å¾®å…‰æ³½å°é¢ç§¯ç‚¹ç›å³å¯'],
        'çº¦ä¼š': ['è¯­é€Ÿæ”¾æ…¢åŠæ‹æ›´ä»å®¹','çº¿æ¡ç®€æ´+æå‡è…°çº¿'],
        'è¿åŠ¨': ['åŠŸèƒ½ä¼˜å…ˆï¼Œé‹ç¨³æŠ“åœ°','å¤–è½»å†…æš–åº”å¯¹æ¸©å·®'],
        'æ—…è¡Œ': ['è½»é‡åˆ†å±‚ï¼Œå£è¢‹æ”¶çº³æœ‰åº','è€è„ä¸­æ€§è‰²ä¼˜å…ˆ']
      },
      tactic:{
        gender:{
          'å¥³': ['å§¿æ€æ‰“å¼€ï¼Œé…ä»¶å°é¢ç§¯å‘¼åº”','ç»†èŠ‚å¹²å‡€=å¯ä¿¡åº¦'],
          'ç”·': ['å…ˆç»™ç»“è®ºï¼Œå†ç»™è¯æ®','é‹é¢å¹²å‡€ï¼Œå‡å°‘æ‚è‰²'],
          'ä¸­æ€§': ['ç»“æ„å…ˆè¡Œï¼Œé™å™ªé…è‰²','é‡ç‚¹>æ¬¡è¦>è¡¥å……']
        },
        age:{
          '18-25': ['ç”¨æµç¨‹å›¾è®²æ¸…æ€è·¯'],
          '26-35': ['é£é™©å‰ç½®+é‡Œç¨‹ç¢‘'],
          '36-45': ['æ”¶ç›Š/æˆæœ¬/è¾¹ç•Œå…ˆè¡Œ']
        },
        weather:{
          'ç‚çƒ­': ['è½»è–„å¤–æ­æ§æ¸©'],
          'å‡‰çˆ½': ['åŠ ä¸€å±‚è–„å¤–å¥—'],
          'å¯’å†·': ['å¤§è¡£+åŒ…è·Ÿé‹æ›´ç¨³'],
          'é›¨å¤©': ['é‹å±¥é˜²æ°´/å¤‡æ›¿æ¢'],
          'é€‚ä¸­': ['åŒè‰²ç³»æ›´å¹²å‡€']
        },
        style:{
          'é€šç”¨': ['ç®€æ´ç•™ç™½ï¼Œä¸€å¤„äº®ç‚¹'],
          'ç”œé…·': ['æè´¨åå·®åšè®°å¿†ç‚¹'],
          'ä¼˜é›…': ['çº¿æ¡å¹²å‡€ï¼Œä½é¥±å’Œ'],
          'æœºèƒ½': ['åŠŸèƒ½ä¼˜å…ˆï¼Œè€ç£¨é¢æ–™'],
          'å•†åŠ¡': ['è½®å»“åˆ©è½ï¼Œä¸‰è‰²ä»¥å†…']
        }
      }
    };
    function renderFortune(scene, luckyColor){
      var weather = (el.weather && el.weather.value) || 'é€‚ä¸­';
      var age     = (el.age && el.age.value) || '26-35';
      var gender  = (el.gender && el.gender.value) || 'ä¸­æ€§';
      var style   = (el.style && el.style.value) || 'é€šç”¨';

      var title = (SHORT.title[scene] && r(SHORT.title[scene])) || 'ä»Šæ—¥å¥½è¿';
      var core  = (SHORT.opener[scene] && r(SHORT.opener[scene])) || 'ç®€æ´æœ‰åŠ›ï¼Œç‰ˆå‹åˆ©è½';
      var tips  = [
        (SHORT.tactic.gender[gender] || [])[0],
        (SHORT.tactic.age[age] || [])[0],
        (SHORT.tactic.weather[weather] || [])[0],
        (SHORT.tactic.style[style] || [])[0]
      ].filter(Boolean);
      var pick2 = [];
      while (tips.length && pick2.length < 2) { pick2.push(tips.splice(Math.floor(Math.random()*tips.length),1)[0]); }

      el.fortune.innerHTML =
        '<div style="font-weight:700;font-size:16px;letter-spacing:.5px;">'+
          'ğŸ“Œ ' + title +
          ' <span style="display:inline-block;width:10px;height:10px;background:'+luckyColor+';border-radius:50%;vertical-align:1px;margin-left:6px" title="ä»Šæ—¥å¹¸è¿è‰²"></span>'+
        '</div>'+
        '<div style="margin-top:6px;"><b>'+ core +'</b></div>'+
        (pick2.length ? '<div style="color:#64748b;margin-top:6px;font-size:13px;">'+ pick2.join(' ï½œ ') +'</div>' : '');
      el.fortune.style.display='block';
    }

    function openSkuModal(){
      var data = persist.read('GOOD_LUCK_SKUS') || SKU_DB.slice();
      el.skuList.innerHTML='';
      for (var i=0;i<data.length;i++){
        var item = data[i];
        var card=$el('<label class="sku-item">'
          + '<input type="checkbox" '+(item.checked!==false?'checked':'')+' data-id="'+item.id+'" style="margin-top:6px;">'
          + '<div><div style="font-weight:600">'+item.name+'</div>'
          + '<div style="font-size:12px;color:#666;">'+item.cat+' Â· '+item.styles.join('/')+' Â· '+item.scenes.join('/')+' Â· '+item.weathers.join('/')+'</div></div>'
          + '</label>');
        el.skuList.appendChild(card);
      }
      el.skuModal.style.display='flex';
    }
    window.openSkuModal = openSkuModal;
    if (el.chooseSKU) el.chooseSKU.addEventListener('click', openSkuModal);
    if (el.skuClose) el.skuClose.onclick = function(){ el.skuModal.style.display='none'; };
    if (el.skuSave) el.skuSave.onclick = function(){
      var cur = persist.read('GOOD_LUCK_SKUS') || structuredClone(SKU_DB);
      var chks = el.skuList.querySelectorAll('input[type="checkbox"]');
      for (var i=0;i<chks.length;i++){
        var chk = chks[i];
        for (var j=0;j<cur.length;j++){ if (cur[j].id===chk.dataset.id){ cur[j].checked = chk.checked; break; } }
      }
      persist.save('GOOD_LUCK_SKUS', cur);
      el.skuModal.style.display='none';
    };

    if (el.upload) el.upload.addEventListener('click', function(){
      var input=document.createElement('input'); input.type='file'; input.accept='image/*';
      input.onchange=function(e){ var f=e.target.files&&e.target.files[0]; if(!f) return; el.avatarImg.src=URL.createObjectURL(f); el.avatarSection.style.display='block'; };
      input.click();
    });

    function generateOutfit(){
      var scene   = (el.scene && el.scene.value) || 'åŒå­¦èšä¼š';
      var weather = (el.weather && el.weather.value) || 'é€‚ä¸­';
      var age     = (el.age && el.age.value) || '18-25';
      var gender  = (el.gender && el.gender.value) || 'ä¸­æ€§';
      var stylePref = (el.style && el.style.value) || 'é€šç”¨';

      var source = persist.read('GOOD_LUCK_SKUS') || SKU_DB;
      var active = [];
      for (var i=0;i<source.length;i++){
        var x = source[i];
        if (x.checked===false) continue;
        if (gender!=='ä¸­æ€§' && x.genders && x.genders.indexOf(gender)===-1) continue;
        active.push(x);
      }

      var sceneStyles = RULES.scene2style[scene] || ['ä¼‘é—²'];
      var weatherCats = RULES.weather2tags[weather] || ['Tæ¤','é•¿è£¤'];
      var styleLikes  = RULES.style2prefer[stylePref] || ['ç®€çº¦'];

      var scored = [];
      for (var k=0;k<active.length;k++){
        var it = active[k], score=0;
        if(it.scenes && it.scenes.indexOf(scene)>-1) score+=2;
        if(it.weathers && it.weathers.indexOf(weather)>-1) score+=2;
        if(it.styles && it.styles.some(function(s){return sceneStyles.indexOf(s)>-1;})) score+=2;
        if(it.styles && it.styles.some(function(s){return styleLikes.indexOf(s)>-1;})) score+=1;
        if(weatherCats.some(function(c){ return new RegExp(c).test(it.cat); })) score+=1;

        if (gender==='å¥³' && (scene==='å•†åŠ¡' || stylePref==='ä¼˜é›…' || stylePref==='å•†åŠ¡')) {
          if (/è¿è¡£è£™|åŠèº«è£™|çŸ­è£™/.test(it.cat)) score+=2;
          if (/è¡¬è¡«/.test(it.cat)) score+=1;
          if (/é«˜è·Ÿé‹/.test(it.cat)) score+=3;
          if (/ä¹ç¦é‹/.test(it.cat)) score+=1;
        }
        if (gender==='ç”·' && (scene==='å•†åŠ¡' || stylePref==='å•†åŠ¡')) {
          if (/é•¿è£¤/.test(it.cat)) score+=2;
          if (/æ­£è£…é‹|ä¹ç¦é‹/.test(it.cat)) score+=2;
        }
        if (weather.indexOf('é›¨')>-1 && /é«˜è·Ÿé‹/.test(it.cat)) score-=3;
        if (weather.indexOf('å¯’')>-1) {
          if (/å¤§è¡£|å¤–å¥—/.test(it.cat)) score+=2;
          if (/é•¿è£¤/.test(it.cat)) score+=1;
          if (/çŸ­è£™|çŸ­è£¤/.test(it.cat)) score-=2;
        }
        scored.push({ref:it, score:score});
      }
      scored.sort(function(a,b){ return b.score-a.score; });
      var scoredRefs = scored.map(function(s){return s.ref;});

      function pickByCats(cats){
        for (var i=0;i<scoredRefs.length;i++){
          var x = scoredRefs[i];
          for (var j=0;j<cats.length;j++){ if (new RegExp(cats[j]).test(x.cat)) return x; }
        }
        return null;
      }

      var topCats = (scene==='å•†åŠ¡' || stylePref==='ä¼˜é›…' || stylePref==='å•†åŠ¡')
        ? ['è¡¬è¡«','è¿è¡£è£™','Tæ¤']
        : (weather.indexOf('å‡‰')>-1 || weather.indexOf('å¯’')>-1 ? ['è¡¬è¡«','Tæ¤','å¤–å¥—'] : ['Tæ¤','è¡¬è¡«']);
      var top = pickByCats(topCats) || scoredRefs[0];

      var bottom;
      if (gender==='å¥³' && (scene==='å•†åŠ¡' || stylePref==='ä¼˜é›…' || stylePref==='å•†åŠ¡') && weather.indexOf('å¯’')===-1) {
        bottom = pickByCats(['åŠèº«è£™','çŸ­è£™']) || pickByCats(['é•¿è£¤','ç‰›ä»”']);
      } else if (gender==='ç”·' && (scene==='å•†åŠ¡' || stylePref==='å•†åŠ¡')) {
        bottom = pickByCats(['é•¿è£¤']) || pickByCats(['ç‰›ä»”']);
      } else {
        bottom = pickByCats(['é•¿è£¤','ç‰›ä»”','çŸ­è£¤','çŸ­è£™']) || scoredRefs[1] || scoredRefs[0];
      }

      var shoeCats;
      if (weather.indexOf('é›¨')>-1) shoeCats = ['é˜²æ°´é‹','é´','è¿åŠ¨é‹','ä¹ç¦é‹'];
      else if (gender==='å¥³' && (scene==='å•†åŠ¡' || stylePref==='ä¼˜é›…' || stylePref==='å•†åŠ¡')) shoeCats = ['é«˜è·Ÿé‹','ä¹ç¦é‹','æ­£è£…é‹','è¿åŠ¨é‹'];
      else if (gender==='ç”·' && (scene==='å•†åŠ¡' || stylePref==='å•†åŠ¡')) shoeCats = ['æ­£è£…é‹','ä¹ç¦é‹','è¿åŠ¨é‹'];
      else shoeCats = ['è¿åŠ¨é‹','ä¹ç¦é‹','æ­£è£…é‹'];
      var shoes = pickByCats(shoeCats) || scoredRefs[2] || scoredRefs[0];

      var coatNeed = weather.indexOf('å‡‰')>-1 || weather.indexOf('é›¨')>-1 || weather.indexOf('å¯’')>-1;
      var coat = coatNeed ? (pickByCats(['å¤§è¡£','å¤–å¥—']) || null) : null;

      var combo = [];
      if (/è¿è¡£è£™/.test(top.cat)) combo = [top, shoes].concat(coat? [coat] : []);
      else combo = [top, bottom, shoes].concat(coat? [coat] : []);

      var baseWeather = pick(getPaletteByWeather(weather));
      var daily = pickDailyColor(gender, stylePref);
      var luckyColor = daily || baseWeather;

      var reason = 'åœºæ™¯åŒ¹é…ï¼š'+((RULES.scene2style[scene]||[]).join(' / ') || 'â€”')
                 + ' ï½œ å¤©æ°”é€‚é…ï¼š'+((RULES.weather2tags[weather]||[]).join('ã€') || 'â€”')
                 + ' ï½œ é£æ ¼åå¥½ï¼š'+((RULES.style2prefer[stylePref]||[]).join(' / ') || 'â€”')
                 + ' ï½œ å¹¸è¿è‰²ï¼š'+luckyColor;

      el.resultMeta.innerHTML = 'åœºæ™¯ï¼š<b>'+scene+'</b>ï¼›å¤©æ°”ï¼š<b>'+weather+'</b>ï¼›å¹´é¾„æ®µï¼š<b>'+age+'</b>ï¼›æ€§åˆ«ï¼š<b>'+gender+'</b>ï¼›é£æ ¼åå¥½ï¼š<b>'+stylePref+'</b>';
      el.resultList.innerHTML = '';

      var neutral = ['#ffffff','#f3f4f6','#e5e7eb','#111827','#000000','#2b303b','#1f2937','#374151'];
      for (var c=0;c<combo.length;c++){
        var it = combo[c];
        var barColor = neutral.indexOf((it.color||'').toLowerCase())>-1 ? luckyColor : (it.color || luckyColor);
        var card = '<div class="outfit-card">'
          + '<div class="name">'+it.name+'</div>'
          + '<div class="meta">'+it.cat+' Â· '+it.styles.join('/')+'</div>'
          + '<div class="bar"><i style="background:'+barColor+'; width:'+(70+c*8)+'%"></i></div>'
          + '<div class="sku">SKUï¼š'+it.id+'</div>'
          + '</div>';
        el.resultList.insertAdjacentHTML('beforeend', card);
      }
      el.resultReason.innerHTML = '<b>æ¨èç†ç”±ï¼š</b>'+reason;
      el.resultSection.style.display='block';

      renderFortune(scene, luckyColor);

      var exported = { scene:scene, weather:weather, age:age, gender:gender, stylePref:stylePref, luckyColor:luckyColor,
        items: combo.map(function(x){return {id:x.id,name:x.name,cat:x.cat};}) };
      persist.save('GOOD_LUCK_LAST', exported);
      return exported;
    }
    window.generateOutfit = generateOutfit;

    if (el.btnCopy) el.btnCopy.addEventListener('click', function(){
      var data = persist.read('GOOD_LUCK_LAST');
      if(!data){ alert('æš‚æ— ç»“æœ'); return; }
      var text = JSON.stringify(data, null, 2);
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(function(){ alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'); });
      } else {
        var ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta);
        ta.style.position='fixed'; ta.style.opacity='0'; ta.select();
        try { document.execCommand('copy') ? alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿') : alert('è¯·é•¿æŒ‰é€‰æ‹©å¤åˆ¶'); }
        finally { ta.parentNode.removeChild(ta); }
      }
    });
    if (el.btnClear) el.btnClear.addEventListener('click', function(){
      localStorage.removeItem('GOOD_LUCK_LAST');
      el.resultSection.style.display='none';
    });

    function maskPhone(p){ return p && p.length===11 ? (p.slice(0,3)+'****'+p.slice(7)) : p; }
    function updateAuthUI(){
      var u = persist.read('AUTH_USER');
      el.authBtn.textContent = (u && u.phone) ? (maskPhone(u.phone) + 'ï¼ˆé€€å‡ºï¼‰') : 'æ³¨å†Œ / ç™»å½•';
    }
    if (el.authBtn) el.authBtn.addEventListener('click', function(){
      var u = persist.read('AUTH_USER');
      if (u && u.phone){ localStorage.removeItem('AUTH_USER'); updateAuthUI(); alert('å·²é€€å‡º'); }
      else { el.authModal.style.display='flex'; setTimeout(function(){ if(el.authPhone) el.authPhone.focus(); }, 0); }
    });
    if (el.authClose) el.authClose.addEventListener('click', function(){ el.authModal.style.display='none'; });
    if (el.authSubmit) el.authSubmit.addEventListener('click', function(){
      var phoneRaw=(el.authPhone.value||'').trim();
      var pass=(el.authPass.value||'').trim();
      var m = phoneRaw.match(/^\s*(?:\+?86[-\s]?)?(1[3-9]\d{9})\s*$/);
      if(!m){ alert('è¯·è¾“å…¥åˆæ³•çš„ä¸­å›½å¤§é™†æ‰‹æœºå·'); return; }
      var phone = m[1];
      if(!pass || pass.length<4){ alert('è¯·è¾“å…¥è‡³å°‘ 4 ä½å¯†ç ï¼ˆæ¼”ç¤ºç”¨ï¼‰'); return; }
      persist.save('AUTH_USER',{phone:phone}); el.authModal.style.display='none'; updateAuthUI(); alert('ç™»å½•æˆåŠŸï¼ˆæ¼”ç¤ºï¼‰');
    });

    (function(){
      var skus = persist.read('GOOD_LUCK_SKUS');
      if (skus){ for(var i=0;i<skus.length;i++){ var s=skus[i]; for(var j=0;j<SKU_DB.length;j++){ if(SKU_DB[j].id===s.id){ SKU_DB[j].checked=s.checked; break; } } } }
      var last = persist.read('GOOD_LUCK_LAST');
      if(last){
        el.resultSection.style.display='block';
        el.resultMeta.innerHTML = 'åœºæ™¯ï¼š<b>'+last.scene+'</b>ï¼›å¤©æ°”ï¼š<b>'+last.weather+'</b>ï¼›å¹´é¾„æ®µï¼š<b>'+last.age+'</b>ï¼›æ€§åˆ«ï¼š<b>'+(last.gender||'ä¸­æ€§')+'</b>ï¼›é£æ ¼åå¥½ï¼š<b>'+last.stylePref+'</b>';
        renderFortune(last.scene, last.luckyColor);
        var html = '';
        for (var i=0;i<last.items.length;i++){
          var it=last.items[i], full=null;
          for (var j=0;j<SKU_DB.length;j++){ if(SKU_DB[j].id===it.id){ full=SKU_DB[j]; break; } }
          var name=(full&&full.name)||it.name||it.id; var cat=(full&&full.cat)||it.cat||'-'; var color=(full&&full.color)||'#eee';
          var neutral=['#ffffff','#f3f4f6','#e5e7eb','#111827','#000000','#2b303b','#1f2937','#374151'];
          var barColor = neutral.indexOf((color||'').toLowerCase())>-1 ? last.luckyColor : (color || last.luckyColor);
          html += '<div class="outfit-card">'
            + '<div class="name">'+name+'</div>'
            + '<div class="meta">'+cat+'</div>'
            + '<div class="bar"><i style="background:'+barColor+'; width:72%"></i></div>'
            + '<div class="sku">SKUï¼š'+it.id+'</div>'
            + '</div>';
        }
        el.resultList.innerHTML = html;
        el.resultReason.innerHTML = '<b>æç¤ºï¼š</b>è¿™æ˜¯ä¸Šæ¬¡ç”Ÿæˆçš„ç»“æœï¼ˆå·²ä»æœ¬åœ°å­˜å‚¨æ¢å¤ï¼‰ã€‚';
      }
      updateAuthUI();
    })();
  </script>
</body>
</html>
